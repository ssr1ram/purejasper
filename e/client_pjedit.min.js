(function(){jade=function(exports){function nulls(val){return null!=val}return Array.isArray||(Array.isArray=function(arr){return"[object Array]"==Object.prototype.toString.call(arr)}),Object.keys||(Object.keys=function(obj){var arr=[];for(var key in obj)obj.hasOwnProperty(key)&&arr.push(key);return arr}),exports.merge=function(a,b){var ac=a["class"],bc=b["class"];(ac||bc)&&(ac=ac||[],bc=bc||[],Array.isArray(ac)||(ac=[ac]),Array.isArray(bc)||(bc=[bc]),ac=ac.filter(nulls),bc=bc.filter(nulls),a["class"]=ac.concat(bc).join(" "));for(var key in b)"class"!=key&&(a[key]=b[key]);return a},exports.attrs=function(obj,escaped){var buf=[],terse=obj.terse;delete obj.terse;var keys=Object.keys(obj),len=keys.length;if(len){buf.push("");for(var i=0;len>i;++i){var key=keys[i],val=obj[key];"boolean"==typeof val||null==val?val&&(terse?buf.push(key):buf.push(key+'="'+key+'"')):0==key.indexOf("data")&&"string"!=typeof val?buf.push(key+"='"+JSON.stringify(val)+"'"):"class"==key&&Array.isArray(val)?buf.push(key+'="'+exports.escape(val.join(" "))+'"'):escaped&&escaped[key]?buf.push(key+'="'+exports.escape(val)+'"'):buf.push(key+'="'+val+'"')}}return buf.join(" ")},exports.escape=function(html){return(html+"").replace(/&(?!(\w+|\#\d+);)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},exports.rethrow=function(err,filename,lineno){if(!filename)throw err;var context=3,str=require("fs").readFileSync(filename,"utf8"),lines=str.split("\n"),start=Math.max(lineno-context,0),end=Math.min(lines.length,lineno+context),context=lines.slice(start,end).map(function(line,i){var curr=i+start+1;return(curr==lineno?"  > ":"    ")+curr+"| "+line}).join("\n");throw err.path=filename,err.message=(filename||"Jade")+":"+lineno+"\n"+context+"\n\n"+err.message,err},exports}({});var require=function(file,cwd){var resolved=require.resolve(file,cwd||"/"),mod=require.modules[resolved];if(!mod)throw Error("Failed to resolve module "+file+", tried "+resolved);var cached=require.cache[resolved],res=cached?cached.exports:mod();return res};require.paths=[],require.modules={},require.cache={},require.extensions=[".js",".coffee",".json",".jade"],require._core={assert:!0,events:!0,fs:!0,path:!0,vm:!0},require.resolve=function(){return function(x,cwd){function loadAsFileSync(x){if(x=path.normalize(x),require.modules[x])return x;for(var i=0;require.extensions.length>i;i++){var ext=require.extensions[i];if(require.modules[x+ext])return x+ext}}function loadAsDirectorySync(x){x=x.replace(/\/+$/,"");var pkgfile=path.normalize(x+"/package.json");if(require.modules[pkgfile]){var pkg=require.modules[pkgfile](),b=pkg.browserify;if("object"==typeof b&&b.main){var m=loadAsFileSync(path.resolve(x,b.main));if(m)return m}else if("string"==typeof b){var m=loadAsFileSync(path.resolve(x,b));if(m)return m}else if(pkg.main){var m=loadAsFileSync(path.resolve(x,pkg.main));if(m)return m}}return loadAsFileSync(x+"/index")}function loadNodeModulesSync(x,start){for(var dirs=nodeModulesPathsSync(start),i=0;dirs.length>i;i++){var dir=dirs[i],m=loadAsFileSync(dir+"/"+x);if(m)return m;var n=loadAsDirectorySync(dir+"/"+x);if(n)return n}var m=loadAsFileSync(x);return m?m:void 0}function nodeModulesPathsSync(start){var parts;parts="/"===start?[""]:path.normalize(start).split("/");for(var dirs=[],i=parts.length-1;i>=0;i--)if("node_modules"!==parts[i]){var dir=parts.slice(0,i+1).join("/")+"/node_modules";dirs.push(dir)}return dirs}if(cwd||(cwd="/"),require._core[x])return x;var path=require.modules.path();cwd=path.resolve("/",cwd);var y=cwd||"/";if(x.match(/^(?:\.\.?\/|\/)/)){var m=loadAsFileSync(path.resolve(y,x))||loadAsDirectorySync(path.resolve(y,x));if(m)return m}var n=loadNodeModulesSync(x,y);if(n)return n;throw Error("Cannot find module '"+x+"'")}}(),require.alias=function(from,to){var path=require.modules.path(),res=null;try{res=require.resolve(from+"/package.json","/")}catch(err){res=require.resolve(from,"/")}for(var basedir=path.dirname(res),keys=(Object.keys||function(obj){var res=[];for(var key in obj)res.push(key);return res})(require.modules),i=0;keys.length>i;i++){var key=keys[i];if(key.slice(0,basedir.length+1)===basedir+"/"){var f=key.slice(basedir.length);require.modules[to+f]=require.modules[basedir+f]}else key===basedir&&(require.modules[to]=require.modules[basedir])}},function(){var process={},global="undefined"!=typeof window?window:{},definedProcess=!1;require.define=function(filename,fn){!definedProcess&&require.modules.__browserify_process&&(process=require.modules.__browserify_process(),definedProcess=!0);var dirname=require._core[filename]?"":require.modules.path().dirname(filename),require_=function(file){var requiredModule=require(file,dirname),cached=require.cache[require.resolve(file,dirname)];return cached&&null===cached.parent&&(cached.parent=module_),requiredModule};require_.resolve=function(name){return require.resolve(name,dirname)},require_.modules=require.modules,require_.define=require.define,require_.cache=require.cache;var module_={id:filename,filename:filename,exports:{},loaded:!1,parent:null};require.modules[filename]=function(){return require.cache[filename]=module_,fn.call(module_.exports,require_,module_,module_.exports,dirname,filename,process,global),module_.loaded=!0,module_.exports}}}(),require.define("path",function(require,module,exports,__dirname,__filename,process){function filter(xs,fn){for(var res=[],i=0;xs.length>i;i++)fn(xs[i],i,xs)&&res.push(xs[i]);return res}function normalizeArray(parts,allowAboveRoot){for(var up=0,i=parts.length;i>=0;i--){var last=parts[i];"."==last?parts.splice(i,1):".."===last?(parts.splice(i,1),up++):up&&(parts.splice(i,1),up--)}if(allowAboveRoot)for(;up--;up)parts.unshift("..");return parts}var splitPathRe=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;exports.resolve=function(){for(var resolvedPath="",resolvedAbsolute=!1,i=arguments.length;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();"string"==typeof path&&path&&(resolvedPath=path+"/"+resolvedPath,resolvedAbsolute="/"===path.charAt(0))}return resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/"),(resolvedAbsolute?"/":"")+resolvedPath||"."},exports.normalize=function(path){var isAbsolute="/"===path.charAt(0),trailingSlash="/"===path.slice(-1);return path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/"),path||isAbsolute||(path="."),path&&trailingSlash&&(path+="/"),(isAbsolute?"/":"")+path},exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p){return p&&"string"==typeof p}).join("/"))},exports.dirname=function(path){var dir=splitPathRe.exec(path)[1]||"",isWindows=!1;return dir?1===dir.length||isWindows&&3>=dir.length&&":"===dir.charAt(1)?dir:dir.substring(0,dir.length-1):"."},exports.basename=function(path,ext){var f=splitPathRe.exec(path)[2]||"";return ext&&f.substr(-1*ext.length)===ext&&(f=f.substr(0,f.length-ext.length)),f},exports.extname=function(path){return splitPathRe.exec(path)[3]||""}}),require.define("__browserify_process",function(require,module,exports,__dirname,__filename,process){var process=module.exports={};process.nextTick=function(){var canSetImmediate="undefined"!=typeof window&&window.setImmediate,canPost="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(canSetImmediate)return function(f){return window.setImmediate(f)};if(canPost){var queue=[];return window.addEventListener("message",function(ev){if(ev.source===window&&"browserify-tick"===ev.data&&(ev.stopPropagation(),queue.length>0)){var fn=queue.shift();fn()}},!0),function(fn){queue.push(fn),window.postMessage("browserify-tick","*")}}return function(fn){setTimeout(fn,0)}}(),process.title="browser",process.browser=!0,process.env={},process.argv=[],process.binding=function(name){if("evals"===name)return require("vm");throw Error("No such module. (Possibly not yet loaded)")},function(){var path,cwd="/";process.cwd=function(){return cwd},process.chdir=function(dir){path||(path=require("path")),cwd=path.resolve(dir,cwd)}}()}),require.define("/page.jade",function(require,module,exports,__dirname,__filename,process,global){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{})buf.push('<div class="container"><div style="position:relative" class="menubar"></div><div style="margin-top:30px" class="main"><div class="paratabs"></div><div class="paraview"><div style="text-align:left;background-color:#ffffff;padding:0px 10px;border-left:1px solid #ddd;border-right:1px solid #ddd;border-bottom:1px solid #ddd" class="paraonpage"><div style="color:#cccccc" class="pull-right paraactions"></div><div'),buf.push(attrs({style:"clear:both;padding:0px 10px;margin-right:16px;height:"+h+"px;overflow:auto","class":"paracontents"},{style:!0})),buf.push('> <div style="padding:4px 6px" class="htmlarea paraspot"></div><div style="display:none" class="editspot paraspot"><textarea'),buf.push(attrs({style:"width:100%;height:"+(h-10)+"px;","class":"editarea"},{style:!0})),buf.push('></textarea></div><div style="display:none" class="widgetspot paraspot"></div></div></div></div><div style="text-align:center"><div style="color:#ccc;margin-top:20px;letter-spacing:3px">&copy; 2013 purejasper.com</div></div></div></div><div style="display:none" class="modal ymodal"></div>');return buf.join("")}}),require.define("/db/dropio.coffee",function(require,module){(function(){var startdb;startdb=require("./startdb"),module.exports={start:function(cb){var self;return self=this,this.client=new Dropbox.Client({key:"d1F4ZEi4WFA=|vpqGx6/s9BAtYdIgqBBv30UIpAuQajpBRVUGrb2hBg==",sandbox:!0}),this.client.authDriver(new Dropbox.Drivers.Redirect({rememberUser:!0})),this.client.authenticate(function(err){return err?(alert("error"),void 0):self.client.getUserInfo(function(err,userInfo){return cb(userInfo)})})},save:function(filename,contents,cb){return this.client.writeFile(filename,contents,{},function(){return cb?cb():void 0})},create:function(filename,cb){var contents;return contents=JSON.stringify(startdb),this.client.writeFile(filename,contents,{},function(){return cb?cb():void 0})},remove:function(filename,cb){return this.client.remove(filename,function(){return cb?cb():void 0})},copyto:function(fromfile,tofile,cb){return this.client.copy(fromfile,tofile,function(){return cb?cb():void 0})},rename:function(fromfile,tofile,cb){return this.client.move(fromfile,tofile,function(){return cb?cb():void 0})},read:function(filename,cb){return this.client.readFile(filename,{},function(err,data){return err?(console.log("error "+err.status),cb(JSON.stringify(startdb))):cb(data)})},readdir:function(dir,cb){return this.client.readdir(dir,{},function(err,data){return data||(data=JSON.stringify(data)),cb(data)})},geturl:function(filename,cb){return this.client.makeUrl(filename,{"long":!0,downloadHack:!0},function(err,data){return cb(err,data)})}}}).call(this)}),require.define("/db/startdb.coffee",function(require,module){(function(){module.exports={paras:[{name:"Home",slug:"home",contents:'<h4>This is a Pure Jasper document.</h4> It contains many paragraphs that link to each other, can be navigated in tabs and have a mix of text, links, html, widgets and scripts.<br><br><ul><li>To Edit this para:&nbsp;Click edit on the top right of this message box</li><li>To Create a new para:&nbsp;Type `[[Para Name]] (without the backtick)&nbsp;</li><ul><li>This will create a special link which when clicked will open a new para in a tab</li><li>Something like this:&nbsp;<a class="paralink" href="#para/about" data-para="about" title="Link: #para/about">About</a></li></ul></ul>Click on the FileName to bring up the File Manager, which allows you to create new documents etc.<br>'},{name:"About",slug:"about",contents:'About this document<br><br>edit me or go back <a class="paralink" href="#para/home" data-para="home">Home</a>&nbsp;'}]}}).call(this)}),require.define("/paras/paratabs.coffee",function(require,module){(function(){var oneParaM,paraTabsT;paraTabsT=require("./paratabs.jade"),oneParaM=require("./onepara.coffee"),module.exports=Backbone.View.extend({initialize:function(){return this.render()},events:{"click .paratab":"doparatab"},render:function(){var paraname,self;return self=this,self.tabsonpage=[],Paradoc.paras.each(function(m){var el;return"Sys-tabs"===m.get("name")?(el=$(m.get("contents")),$("a",el).each(function(){return self.tabsonpage.push($(this).attr("data-para"))})):void 0}),0===self.tabsonpage.length&&(self.tabsonpage=["Home","About"]),this.painttabs(),paraname="Home",Paradoc.paras.each(function(m){return m.get("name")===paraname?new oneParaM({model:m}):void 0})},painttabs:function(activepara){var activetab,i,t,_i,_len,_ref;if(activepara)for(_ref=this.tabsonpage,i=_i=0,_len=_ref.length;_len>_i;i=++_i)t=_ref[i],t===activepara&&(activetab=i);else activetab=0;return $(this.el).html(paraTabsT({tabs:this.tabsonpage,activetab:activetab})),$(this.options.parent).html(this.el),this.delegateEvents()},doparatab:function(ev){var paraname;if(!Paradoc.isediting)return $(".paratabwrap").removeClass("active"),$(ev.target).closest(".paratabwrap").addClass("active"),paraname=$(ev.target).attr("data-paraname"),ev.preventDefault(),console.log("pn "+paraname),Paradoc.paras.each(function(m){return m.get("name")===paraname?new oneParaM({model:m}):void 0})},addatab:function(paraslug,paraname){var m,mrs,para,self;return self=this,para=null,mrs=Paradoc.paras.where({slug:paraslug}),mrs&&(para=mrs[0]),para||(console.log("xxno para"),m=new Backbone.Model({name:paraname,slug:paraslug,contents:""}),Paradoc.paras.add(m),self.tabsonpage.push(paraname),self.painttabs(paraname)),$(".paratab[data-paraname='"+paraname+"']").length>0?$(".paratab[data-paraname='"+paraname+"']").click():(self.tabsonpage.push(paraname),self.painttabs(paraname),$(".paratab[data-paraname='"+paraname+"']").click())},rmatab:function(paraname){var i,t,_i,_len,_ref,_results;for(_ref=this.tabsonpage,_results=[],i=_i=0,_len=_ref.length;_len>_i;i=++_i)t=_ref[i],t===paraname?($(".paratab[data-paraname='"+this.tabsonpage[i-1]+"']").click(),this.tabsonpage.splice(i,1),_results.push($(".paratab[data-paraname='"+paraname+"']").closest(".paratabwrap").remove())):_results.push(void 0);return _results}})}).call(this)}),require.define("/paras/paratabs.jade",function(require,module,exports,__dirname,__filename,process,global){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp;buf.push('<div style="margin-top:2px"><ul style="margin-bottom:0px" class="nav nav-tabs paratabmom">'),function(){if("number"==typeof tabs.length)for(var i=0,$$l=tabs.length;$$l>i;i++){var tab=tabs[i];i===activetab?(buf.push('<li class="active paratabwrap"><a'),buf.push(attrs({"data-paraname":""+tab,"class":"paratab"},{"data-paraname":!0})),buf.push(">"+escape(null==(interp=tab)?"":interp)+"</a></li>")):(buf.push('<li class="paratabwrap"><a'),buf.push(attrs({"data-paraname":""+tab,"class":"paratab"},{"data-paraname":!0})),buf.push(">"+escape(null==(interp=tab)?"":interp)+"</a></li>"))}else{var $$l=0;for(var i in tabs){$$l++;var tab=tabs[i];i===activetab?(buf.push('<li class="active paratabwrap"><a'),buf.push(attrs({"data-paraname":""+tab,"class":"paratab"},{"data-paraname":!0})),buf.push(">"+escape(null==(interp=tab)?"":interp)+"</a></li>")):(buf.push('<li class="paratabwrap"><a'),buf.push(attrs({"data-paraname":""+tab,"class":"paratab"},{"data-paraname":!0})),buf.push(">"+escape(null==(interp=tab)?"":interp)+"</a></li>"))}}}.call(this),buf.push("</ul></div>")}return buf.join("")}}),require.define("/paras/onepara.coffee",function(require,module){(function(){var basicPM,oneParaT,oneParaactionsM,plateselPM;oneParaT=require("./onepara.jade"),basicPM=require("../plugins/basic"),plateselPM=require("../plugins/platesel"),oneParaactionsM=require("./oneparaactions"),module.exports=Backbone.View.extend({initialize:function(){return this.render()},render:function(){var self;return self=this,this.ora=new oneParaactionsM({model:this.model,thepara:this}),this.model.get("contents")?this.model.get("source")?$.getScript(this.model.get("source")).done(function(){return console.log("aa"),self.plugin=window.Paradoc._para,self.plugin.zview=new window.Paradoc._para.showview({model:self.model,parent:$(".htmlarea"),thepara:self})}).fail(function(xhr,settings,exception){return console.log("err "+exception)}):(self.plugin=basicPM,self.plugin.zview=new self.plugin.showview({model:this.model,parent:$(".htmlarea"),thepara:self})):this.plugin=new plateselPM({model:this.model,parent:$(".htmlarea")})},showedit:function(){return this.plugin.zedit&&(this.plugin.zedit.remove(),this.plugin.zedit.unbind()),this.plugin.zview&&(this.plugin.zview.remove(),this.plugin.zview.unbind()),$(".paraspot").hide(),this.plugin.zedit=new this.plugin.editview({model:this.model,thepara:self}),this.plugin.noeditor?($(".widgetspot").html(this.plugin.zedit.el).show(),this.plugin.zedit.delegateEvents()):($(".wysihtml5-toolbar").hasClass("editspot")||$(".wysihtml5-toolbar").addClass("editspot").addClass("paraspot").appendTo(".menubar").css({position:"absolute",top:"0px",left:"0px"}),$(".editspot").show(),Paradoc.editor.setValue($(this.plugin.zedit.el).html()))},showview:function(){var self;return self=this,this.plugin.zedit&&(this.plugin.zedit.remove(),this.plugin.zedit.unbind()),this.plugin.zview&&(this.plugin.zview.remove(),this.plugin.zview.unbind()),$(".paraspot").hide(),$(".editarea").val(""),self.plugin.zview=new self.plugin.showview({model:this.model,parent:$(".htmlarea"),thepara:self}),$(".htmlarea").show()},getModel:function(){var m;return m=this.plugin.zedit.getModel($(".editarea").val())}})}).call(this)}),require.define("/paras/onepara.jade",function(require,module,exports,__dirname,__filename,process,global){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{})buf.push('<div><div style="text-align:left;background-color:#ffffff;padding:0px 10px;border-left:1px solid #ddd;border-right:1px solid #ddd;border-bottom:1px solid #ddd" class="paraonpage"><div style="color:#cccccc" class="pull-right paraactions"></div><div'),buf.push(attrs({style:"clear:both;padding:0px 10px;margin-right:16px;height:"+h+"px","class":"paracontents"},{style:!0})),buf.push('> <div style="padding:4px 6px" class="htmlarea paraspot"></div><div style="display:none" class="editspot paraspot"><textarea'),buf.push(attrs({style:"width:100%;height:"+(h-10)+"px;","class":"editarea"},{style:!0})),buf.push('></textarea></div><div style="display:none" class="widgetspot paraspot"></div></div></div></div>');return buf.join("")}}),require.define("/plugins/basic.coffee",function(require,module){(function(){module.exports={showview:Backbone.View.extend({initialize:function(){return this.render()},render:function(){var html;return html=this.model.get("contents"),$(this.el).html(html),$(this.options.parent).html(this.el)}}),editview:Backbone.View.extend({initialize:function(){return this.render()},render:function(){var html;return html=this.model.get("contents"),$(this.el).html(html)},getModel:function(contents){return this.model.set("contents",contents),this.model}})}}).call(this)}),require.define("/plugins/platesel.coffee",function(require,module){(function(){var plateselT,utils;plateselT=require("./platesel.jade"),utils=require("../utils/utils"),module.exports=Backbone.View.extend({initialize:function(){return this.render()},events:{"click .dotemplate":"dotemplate","click .platesel":"doplatesel"},render:function(){var self;return self=this,console.log("a"),utils.getJson("/e/data/plates/list.jsonp",function(data){return $(self.el).html(plateselT({plates:data.plates})),$(self.options.parent).html(self.el),$(".doedit").hide()})},gethtml:function(){var text;return text=this.model.get("contents")},doplatesel:function(){var source;return source=$(".platesel").val(),console.log("ss "+source),$.getScript(source,function(){var _para;return _para=window.Paradoc._para,$(".plateview").html(_para.html()).css({zoom:"50%"})})},dotemplate:function(){var self,source;return self=this,source=$(".platesel").val(),$.getScript(source,function(){var _para;return _para=window.Paradoc._para,self.model.set("contents",_para.html()),self.model.set("data",_para.data),self.model.set("source",source),self.unbind(),self.remove(),$(".paratab[data-paraname='"+self.model.get("name")+"']").click()})}})}).call(this)}),require.define("/plugins/platesel.jade",function(require,module,exports,__dirname,__filename,process,global){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp;buf.push('<h3>Choose a template</h3><div style="margin:10px 5px" class="row-fluid"><div class="span3"><select size="10" style="width:90%" class="platesel">'),function(){if("number"==typeof plates.length)for(var $index=0,$$l=plates.length;$$l>$index;$index++){var plate=plates[$index];buf.push("<option"),buf.push(attrs({value:""+plate.source},{value:!0})),buf.push(">"+escape(null==(interp=plate.label)?"":interp)+"</option>")}else{var $$l=0;for(var $index in plates){$$l++;var plate=plates[$index];buf.push("<option"),buf.push(attrs({value:""+plate.source},{value:!0})),buf.push(">"+escape(null==(interp=plate.label)?"":interp)+"</option>")}}}.call(this),buf.push('</select></div><div class="span9"><div style="margin:30px;padding:20px;min-height:250px;zoom:50%;border:1px solid #cccccc" class="plateview">select a template</div></div></div><div style="margin:10px" class="row-fluid"><div class="pull-right"><button class="btn dotemplate">Create</button></div></div>')}return buf.join("")}}),require.define("/utils/utils.coffee",function(require,module){(function(){module.exports.slugify=function(text){return text=text.replace(/[^-a-zA-Z0-9,&\s]+/gi,""),text=text.replace(/-/gi,"_"),text=text.replace(/\s/gi,"-"),text=text.toLowerCase()},module.exports.getJson=function(url,cb){return $.ajax({url:url,type:"GET",dataType:"jsonp",jsonpCallback:"paradocJson",success:function(data){return cb(data)},error:function(xhr,text,err){return console.log("err "+err),console.log("url "+url)}})}}).call(this)}),require.define("/paras/oneparaactions.coffee",function(require,module){(function(){var dropio,oneParaactionsRoT,oneParaactionsT;oneParaactionsT=require("./oneparaactions.jade"),oneParaactionsRoT=require("./oneparaactions-ro.jade"),dropio=require("../db/dropio"),module.exports=Backbone.View.extend({initialize:function(){return this.render()},events:{"click .doedit":"doedit","click .dosave":"dosave","click .doxncl":"doxncl","click .doclose":"doclose","click .dodel":"dodel"},render:function(){return Paradoc.readonly?$(this.el).html(oneParaactionsRoT({para:this.model.toJSON()})):$(this.el).html(oneParaactionsT({para:this.model.toJSON()})),$(".paraactions").html(this.el)},doedit:function(){return Paradoc.isediting=!0,this.options.thepara.showedit(),$(".savegroup",this.el).show(),$(".editgroup",this.el).hide()},doxncl:function(){return Paradoc.isediting=!1,this.options.thepara.showview(),$(".savegroup",self.el).hide(),$(".editgroup",self.el).show()},doclose:function(){return Paradoc.paratabs.rmatab(this.model.get("name"))},dosave:function(){var paramodel,paraname,self;return self=this,paramodel=this.options.thepara.getModel(),paraname=paramodel.get("name"),Paradoc.paras.each(function(m){var d;return m.get("name")===paraname?(m=paramodel,d={paras:Paradoc.paras.toJSON()},dropio.save(Paradoc.doc,JSON.stringify(d),function(){return self.doxncl()})):void 0})},dodel:function(){var mrs,paraslug;return paraslug=this.options.thepara.model.get("slug"),mrs=Paradoc.paras.where({slug:paraslug}),mrs?(this.doxncl(),Paradoc.paras.remove(mrs[0]),Paradoc.paratabs.rmatab(mrs[0].get("name")),dropio.save(Paradoc.doc,JSON.stringify({paras:Paradoc.paras.toJSON()}))):void 0}})}).call(this)}),require.define("/paras/oneparaactions.jade",function(require,module,exports,__dirname,__filename,process,global){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{})buf.push('<div class="editgroup"><span class="doedit pointer word">edit</span>'),"home"!=para.slug&&buf.push('<span class="doclose pointer word">close</span>'),buf.push('</div><div style="display:none" class="savegroup">'),"home"!=para.slug&&buf.push('<span style="color:red;padding-right:15px" class="dodel pointer">delete</span>'),buf.push('<span class="dosave pointer word">save</span><span class="doxncl pointer word">cancel</span></div>');return buf.join("")}}),require.define("/paras/oneparaactions-ro.jade",function(require,module,exports,__dirname,__filename,process,global){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{})buf.push('<div class="editgroup">'),"home"!=para.slug&&buf.push('<span class="doclose pointer word">close</span>'),buf.push('</div><div style="display:none" class="savegroup">'),"home"!=para.slug&&buf.push('<span class="doclose pointer word">close</span>'),buf.push("</div>");return buf.join("")}}),require.define("/filemanager/actions.coffee",function(require,module){(function(){var dropio,fileactionsT,managerM;fileactionsT=require("./actions.jade"),managerM=require("./manager.coffee"),dropio=require("../db/dropio"),module.exports=Backbone.View.extend({initialize:function(){return this.filename=this.options.filename,this.render()},events:{"click .domanager":"domanager"},render:function(){return $(this.el).html(fileactionsT({filename:this.filename})),$(".menubar").html(this.el)},domanager:function(ev){var m;return m=new managerM,ev.preventDefault()},xdomanager:function(ev){return dropio.readdir("/",function(flist){return $(".ymodal").empty().html(managerT({flist:flist})).show(),$(".ymodal").modal("show")}),ev.preventDefault()}})}).call(this)}),require.define("/filemanager/actions.jade",function(require,module,exports,__dirname,__filename,process,global){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp;buf.push('<div style="position:absolute;top:0px;right:0px"><div style="margin-top:0px" class="btn-toolbar"><div class="btn-group"><button class="btn"><span style="font-size:30px">'+escape(null==(interp=filename.replace(".pjs",""))?"":interp)+'</span></button><button data-toggle="dropdown" style="padding:7px 15px 8px 15px" class="btn dropdown-toggle"> <span class="caret"></span></button><ul class="dropdown-menu"><li><a class="domanager">File Manager</a></li></ul></div></div></div>')}return buf.join("")}}),require.define("/filemanager/manager.coffee",function(require,module){(function(){var copytoT,deleteT,dropio,managerT,newT,noselT,publishT,publishmlT,renameT;managerT=require("./manager.jade"),dropio=require("../db/dropio"),copytoT=require("./copyto.jade"),renameT=require("./rename.jade"),deleteT=require("./delete.jade"),newT=require("./new.jade"),noselT=require("./nosel.jade"),publishT=require("./publish.jade"),publishmlT=require("./publishml.jade"),module.exports=Backbone.View.extend({initialize:function(){return this.render()},events:{"click .docopyto":"docopyto","click .dorename":"dorename","click .dodelete":"dodelete","click .donew":"donew","click .doopen":"doopen","click .dopublish":"dopublish","click .showcopyto":"showcopyto","click .showrename":"showrename","click .showdelete":"showdelete","click .shownew":"shownew"},render:function(){var self;return self=this,dropio.readdir("/",function(flist){var f,_i,_len;for(self.flist=[],_i=0,_len=flist.length;_len>_i;_i++)f=flist[_i],-1!==f.indexOf(".pjs")&&self.flist.push(f);return $(self.el).html(managerT({flist:self.flist})),self.delegateEvents(),$(".ymodal").empty().html(self.el).show(),$(".ymodal").modal("show")})},getthefile:function(){return this.thefile=$(".thefile").val(),this.thefile?!0:($(".actionspot",this.el).html(noselT),!1)},showcopyto:function(){return this.getthefile()?$(".actionspot",this.el).html(copytoT({thefile:this.thefile})):void 0},showrename:function(){return this.getthefile()?$(".actionspot",this.el).html(renameT({thefile:this.thefile})):void 0},showdelete:function(){return this.getthefile()?$(".actionspot",this.el).html(deleteT({thefile:this.thefile})):void 0},shownew:function(){return $(".actionspot",this.el).html(newT)},docopyto:function(){var f,fxists,self,tofile,_i,_len,_ref;if(self=this,tofile=$("input[name='tofile']").val(),!tofile)return $(".errspot",this.el).html("Please enter a file name"),void 0;for(fxists=!1,_ref=this.flist,_i=0,_len=_ref.length;_len>_i;_i++)f=_ref[_i],tofile.replace(".pjs","")===f.replace(".pjs","")&&(fxists=!0);return fxists?($(".errspot",this.el).html("File exists"),void 0):(-1===tofile.indexOf(".pjs")&&(tofile+=".pjs"),dropio.copyto(this.thefile,tofile,function(){return $(".ymodal").modal("hide"),$(self.el).remove(),self.render()}))},dorename:function(){var f,fxists,self,tofile,_i,_len,_ref;if(self=this,tofile=$("input[name='tofile']").val(),!tofile)return $(".errspot",this.el).html("Please enter a file name"),void 0;for(fxists=!1,_ref=this.flist,_i=0,_len=_ref.length;_len>_i;_i++)f=_ref[_i],tofile.replace(".pjs","")===f.replace(".pjs","")&&(fxists=!0);return fxists?($(".errspot",this.el).html("File exists"),void 0):(-1===tofile.indexOf(".pjs")&&(tofile+=".pjs"),dropio.rename(this.thefile,tofile,function(){return $(".ymodal").modal("hide"),$(self.el).remove(),self.render()}))},dodelete:function(){var self,x;return self=this,dropio.remove(this.thefile,function(){return $(".ymodal").modal("hide"),$(self.el).remove(),self.render()}),x=1},donew:function(){var f,fxists,nufile,_i,_len,_ref;if(nufile=$("input[name='nufile']").val(),!nufile)return $(".errspot",this.el).html("Please enter a file name"),void 0;for(fxists=!1,_ref=this.flist,_i=0,_len=_ref.length;_len>_i;_i++)f=_ref[_i],nufile.replace(".pjs","")===f.replace(".pjs","")&&(fxists=!0);return fxists?($(".errspot",this.el).html("File exists"),void 0):(-1===nufile.indexOf(".pjs")&&(nufile+=".pjs"),dropio.create(nufile,function(){return Paradoc.navigate("#doc/"+nufile,!1),location.reload()}))},doopen:function(){return this.getthefile()?(Paradoc.navigate("#doc/"+this.thefile,!1),location.reload()):void 0},dopublish:function(){var d,fname,html,self;return self=this,this.thefile=$(".thefile").val(),this.thefile?(d={paras:Paradoc.paras.toJSON()},html=publishmlT({paras:JSON.stringify(d),now:(new Date).getTime()}),fname=this.thefile.replace(".pjs","")+".html",console.log(html),dropio.save(fname,html,function(){return console.log("saved"),dropio.geturl(fname,function(err,url){return console.log("url is "+url.url),$(".actionspot",this.el).html(publishT({thefile:self.thefile,theurl:url.url.replace("www.","dl.").replace("https","http")}))})})):void 0}})}).call(this)}),require.define("/filemanager/manager.jade",function(require,module,exports,__dirname,__filename,process,global){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp;buf.push('<div class="modal-header"><button type="button" data-dismiss="modal" class="close">x</button><h3>File Manager</h3></div><div class="modal-body"><div class="row-fluid"><div style="height:250px" class="span5"><select size="16" style="width:100%" class="thefile">'),function(){if("number"==typeof flist.length)for(var $index=0,$$l=flist.length;$$l>$index;$index++){var f=flist[$index];
buf.push("<option>"+escape(null==(interp=f)?"":interp)+"</option>")}else{var $$l=0;for(var $index in flist){$$l++;var f=flist[$index];buf.push("<option>"+escape(null==(interp=f)?"":interp)+"</option>")}}}.call(this),buf.push('</select></div><div class="span2"><div class="btn-group btn-group-vertical"><button class="btn"><span class="doopen">Open</span></button><button style="margin-top:20px" class="btn"><span class="showcopyto">Copy to</span></button><button class="btn"><span class="showrename">Rename</span></button><button style="margin-top:20px" class="btn"><span class="showdelete">Delete</span></button><button style="margin-top:30px" class="btn"><span class="shownew">New File</span></button><button style="margin-top:30px" class="btn"><span class="dopublish">Publish</span></button></div></div><div style="height:250px;border:2px solid #ddd;padding-left:2px" class="span5 actionspot"></div></div></div><div class="modal-footer"><a href="#" data-dismiss="modal" class="btn">Cancel</a></div>')}return buf.join("")}}),require.define("/filemanager/copyto.jade",function(require,module,exports,__dirname,__filename,process,global){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{})buf.push("<div><h3>Copy To<div><label>From</label><input"),buf.push(attrs({type:"text",readonly:"true",value:""+thefile,style:"width:90%"},{type:!0,readonly:!0,value:!0,style:!0})),buf.push('/></div><div><label>To</label><input type="text" name="tofile" placeholder="filename" style="width:90%"/></div><div style="margin:10px;text-align:center"><button class="docopyto">Copy</button></div></h3><div style="color:red;text-align:center" class="errspot"></div></div>');return buf.join("")}}),require.define("/filemanager/rename.jade",function(require,module,exports,__dirname,__filename,process,global){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{})buf.push("<div><h3>Rename<div><label>From</label><input"),buf.push(attrs({type:"text",readonly:"true",value:""+thefile,style:"width:90%"},{type:!0,readonly:!0,value:!0,style:!0})),buf.push('/></div><div><label>To</label><input type="text" name="tofile" placeholder="filename" style="width:90%"/></div><div style="margin:10px;text-align:center"><button class="dorename">rename</button></div></h3><div style="color:red;text-align:center" class="errspot"></div></div>');return buf.join("")}}),require.define("/filemanager/delete.jade",function(require,module,exports,__dirname,__filename,process,global){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{})buf.push("<div><h3>Delete<div><label>File</label><input"),buf.push(attrs({type:"text",readonly:"true",value:""+thefile,style:"width:90%"},{type:!0,readonly:!0,value:!0,style:!0})),buf.push('/></div><div style="margin:10px;text-align:center"><button class="dodelete">Confirm Delete</button></div></h3></div>');return buf.join("")}}),require.define("/filemanager/new.jade",function(require,module,exports,__dirname,__filename,process,global){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{})buf.push('<div><h3>New File</h3><div><label>File name</label><input type="text" name="nufile" placeholder="filename" style="width:90%"/></div><div style="margin:10px;text-align:center"><button class="donew">Create & open file</button></div><div style="color:red;text-align:center" class="errspot"></div></div>');return buf.join("")}}),require.define("/filemanager/nosel.jade",function(require,module,exports,__dirname,__filename,process,global){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{})buf.push("<div><h3>Error<div><label>Please select a file</label></div></h3></div>");return buf.join("")}}),require.define("/filemanager/publish.jade",function(require,module,exports,__dirname,__filename,process,global){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{})buf.push("<div><h3>Published url<div><label>File</label><input"),buf.push(attrs({type:"text",readonly:"true",value:""+thefile,style:"width:90%"},{type:!0,readonly:!0,value:!0,style:!0})),buf.push("/></div><div><label>url</label><input"),buf.push(attrs({type:"text",readonly:"true",value:""+theurl,style:"width:90%"},{type:!0,readonly:!0,value:!0,style:!0})),buf.push("/></div></h3></div>");return buf.join("")}}),require.define("/filemanager/publishml.jade",function(require,module,exports,__dirname,__filename,process,global){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp;buf.push('<html><head><title>PureJasper - Personal Html5 notebooks</title><link href="//ssr1ram.github.io/purejasper/e/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen"/><link href="//ssr1ram.github.io/purejasper/e/css/bootstrap-wysihtml5.css" rel="stylesheet" media="screen"/><link rel="//ssr1ram.github.io/purejasper/e/stylesheet/less" type="text/css" href="./app.less"/><script type="text/javascript" src="//ssr1ram.github.io/purejasper/e/lib/underscore-min.js"></script><script type="text/javascript" src="//ssr1ram.github.io/purejasper/e/lib/dropbox.js"></script><script type="text/javascript" src="//ssr1ram.github.io/purejasper/e/lib/wysihtml5-0.3.0.js"></script><script type="text/javascript" src="//ssr1ram.github.io/purejasper/e/lib/jquery.js"></script><script type="text/javascript" src="//ssr1ram.github.io/purejasper/e/lib/backbone-min.js"></script><script type="text/javascript" src="//ssr1ram.github.io/purejasper/e/bootstrap/js/bootstrap.min.js"></script><script type="text/javascript" src="//ssr1ram.github.io/purejasper/e/lib/less.js"></script><script type="text/javascript" src="//ssr1ram.github.io/purejasper/e/lib/showdown.js"></script><script type="text/javascript" src="//ssr1ram.github.io/purejasper/e/lib/bs-wysi5.js"></script></head><body style="background-color:#f4f4f4"><div style="text-align:center"><h1 style="margin:100px auto">Loading...</h1></div><script>var jdoc = '+(null==(interp=paras)?"":interp)+';\n</script><script type="text/javascript" src="//ssr1ram.github.io/purejasper/e/client_pjview.min.js?v=#_now}"></script></body></html>')}return buf.join("")}}),require.define("/utils/wiki_link.coffee",function(require,module){(function(){var WIKI_REGEX,utils,_convertWikiLink,_getTempElement,_parseNode,_wrapMatchesInNode;utils=require("./utils"),WIKI_REGEX=/(?:^|\s)\[\[(.*)\]\](?=\s|$)/,_convertWikiLink=function(str){var matches,slug;return matches=str.match(WIKI_REGEX),matches&&(slug=utils.slugify(matches[1]),str=str.replace(WIKI_REGEX," <a class='paralink' href='#para/"+slug+"' data-para='"+slug+"'>"+matches[1]+"</a>")),str},_getTempElement=function(context){var tempElement;return tempElement=context._wysihtml5_tempElement,tempElement||(tempElement=context._wysihtml5_tempElement=context.createElement("div")),tempElement},_wrapMatchesInNode=function(textNode){var parentNode,tempElement;for(parentNode=textNode.parentNode,tempElement=_getTempElement(parentNode.ownerDocument),tempElement.innerHTML="<span></span>"+_convertWikiLink(textNode.data),tempElement.removeChild(tempElement.firstChild);tempElement.firstChild;)parentNode.insertBefore(tempElement.firstChild,textNode);return parentNode.removeChild(textNode)},_parseNode=function(element){var childNodes,childNodesLength,i,node,_i,_len;if(element.nodeType===wysihtml5.TEXT_NODE&&element.data.match(WIKI_REGEX))return _wrapMatchesInNode(element),void 0;for(childNodes=wysihtml5.lang.array(element.childNodes).get(),childNodesLength=childNodes.length,i=0,_i=0,_len=childNodes.length;_len>_i;_i++)node=childNodes[_i],_parseNode(node);return element},module.exports=function(element){return _parseNode(element)}}).call(this)}),require.define("/app.coffee",function(require){(function(){var AppRouter,WIKI_REGEX,appRouter,dropio,fileactionsM,pageT,paraTabsM,utils,v,wikilink;pageT=require("./page"),dropio=require("./db/dropio"),paraTabsM=require("./paras/paratabs"),fileactionsM=require("./filemanager/actions"),wikilink=require("./utils/wiki_link"),utils=require("./utils/utils"),WIKI_REGEX=/\[\[(.*)\]\]/,v=Backbone.View.extend({el:"body",initialize:function(){var self;return self=this,this.filename=this.options.doc,dropio.read(this.filename,function(data){var jdoc;JSON.parse(data);try{jdoc=JSON.parse(data)}catch(e){console.log("bad data"),jdoc={paras:[]}}return Paradoc.paras=jdoc.rams?new Backbone.Collection(jdoc.rams):new Backbone.Collection(jdoc.paras),Paradoc.paras.each(function(m){return m.get("slug")?void 0:m.set("slug",utils.slugify(m.get("name")))}),Paradoc.doc=self.filename,self.render()})},events:{"click .paralink":"doparalink"},doparalink:function(ev){var paraname,paraslug;return paraslug=$(ev.target).attr("data-para"),paraname=$(ev.target).text(),Paradoc.paratabs.addatab(paraslug,paraname),ev.preventDefault()},render:function(){var fa,h,self,w;return self=this,h=$(window).height()-150,150>h&&(h=150),w=$(".container.main").width(),$(self.el).html(pageT({h:h,w:w,doc:Paradoc.doc})),$("#user-name").text(Paradoc.userInfo.name),fa=new fileactionsM({filename:this.filename}),Paradoc.paratabs=new paraTabsM({parent:$(".paratabs",self.el)}),Paradoc.seteditor()}}),AppRouter=Backbone.Router.extend({routes:{"":"home",home:"home","doc/:doc":"home","*notFound":"notFound"},home:function(doc){var mainV;return doc||(doc="notes.pjs"),-1===doc.indexOf(".pjs")&&(doc+=".pjs"),mainV=new v({doc:doc})},notFound:function(){return this.navigate("",!0)}}),appRouter=new AppRouter,$(function(){return window.Paradoc={ext:"pjs",init:function(){return this.readonly=!1},navigate:function(path,trigger){return null==trigger&&(trigger=!0),appRouter.navigate(path,{trigger:trigger})},seteditor:function(){var self;return self=this,this.editor=$(".editarea").wysihtml5({stylesheets:["bootstrap/css/bootstrap.min.css","app.css"]}).data("wysihtml5").editor,this.editor.on("newword:composer",function(){var composer,edittext,matches;return edittext=self.editor.getValue(),matches=edittext.match(WIKI_REGEX),console.log("m "+matches),matches?(composer=self.editor.composer,composer.selection.executeAndRestore(function(startContainer,endContainer){return wikilink(endContainer.parentNode)})):void 0})},dropio:dropio},window.Paradoc.init(),dropio.start(function(userInfo){return Paradoc.userInfo=userInfo,Backbone.history.start()})})}).call(this)}),require("/app.coffee")})();